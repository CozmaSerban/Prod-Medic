<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.98.0">
  <title>Dashboard Template Â· Bootstrap v5.2</title>

  <link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/dashboard/">

  <!-- CSS only -->
  <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
    crossorigin="anonymous"></script>

  <!-- <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet"> -->

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }

    .b-example-divider {
      height: 3rem;
      background-color: rgba(0, 0, 0, .1);
      border: solid rgba(0, 0, 0, .15);
      border-width: 1px 0;
      box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
    }

    .b-example-vr {
      flex-shrink: 0;
      width: 1.5rem;
      height: 100vh;
    }

    .bi {
      vertical-align: -.125em;
      fill: currentColor;
    }

    .nav-scroller {
      position: relative;
      z-index: 2;
      height: 2.75rem;
      overflow-y: hidden;
    }

    .nav-scroller .nav {
      display: flex;
      flex-wrap: nowrap;
      padding-bottom: 1rem;
      margin-top: -1px;
      overflow-x: auto;
      text-align: center;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
  </style>


  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</head>

<body>

  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="#">Administrare</a>
    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse"
      data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-nav">
      <div class="nav-item text-nowrap">
        <a class="nav-link px-3" href="{{ url_for('auth.logout') }}">Sign out</a>
      </div>
    </div>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="{{ url_for('index') }}">
                <span data-feather="home" class="align-text-bottom"></span>
                Pagina principala
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('patients') }}">
                <span data-feather="file" class="align-text-bottom"></span>
                Pacienti
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('auth.profile') }}">
                <span data-feather="shopping-cart" class="align-text-bottom"></span>
                Contul meu
              </a>
            </li>

          </ul>

          <!-- <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted text-uppercase">
          <span>Saved reports</span>
          <a class="link-secondary" href="#" aria-label="Add a new report">
            <span data-feather="plus-circle" class="align-text-bottom"></span>
          </a>
        </h6>
        <ul class="nav flex-column mb-2">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text" class="align-text-bottom"></span>
              Current month
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text" class="align-text-bottom"></span>
              Last quarter
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text" class="align-text-bottom"></span>
              Social engagement
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <span data-feather="file-text" class="align-text-bottom"></span>
              Year-end sale
            </a>
          </li>
        </ul> -->
        </div>
      </nav>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">Total pacienti</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group me-2">
              <!-- <button type="button" class="btn btn-sm btn-outline-secondary">Share</button> -->
              <button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="modal"
                data-target="#exampleModalCenter">Adaugare pacient nou</button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="modal"
                data-target="#exampleModalCenter2">Adaugare pacient existent</button>
              <button type="button" class="generate_excel btn btn-sm btn-outline-secondary">Export</button>

            </div>

          </div>
        </div>


        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th scope="col">Nume/Prenume</th>
                <th scope="col">CNP</th>
                
                <th scope="col">Schema tratament</th>
                <th scope="col">Detalii</th>
                <th scope="col">Modifica informatii</th>
                <th scope="col">Sterge cont</th>

              </tr>
            </thead>
            <tbody id="patients">
          
            </tbody>
          </table>
        </div>
      </main>
    </div>
  </div>

  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Adaugare date pacient</h5>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group row" style="margin-top:10px;">
              <label for="nume" class="col-sm-2 col-form-label">Nume</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="nume" placeholder="Nume">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="prenume" class="col-sm-2 col-form-label">Prenume</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="prenume" placeholder="Prenume">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="cnp" class="col-sm-2 col-form-label">CNP</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="CNP" placeholder="CNP">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="cnp" class="col-sm-2 col-form-label">Tratament</label>
              <div class="form-group col-sm-10">
                <select id="tratament" class="form-control">
                  <option selected>Choose...</option>
                  <option>Interferon beta (Avonex, Betaferon, Rebif) </option>
                  <option>Glatiramer acetat</option>
                  <option>Fingolimod</option>
                  <option>Terliflunomida</option>
                  <option>Dimetil fumarate</option>
                  <option>Ocrelizumab</option>
                  <option>Natalizumab</option>
                  <option>Alemtuzumab</option>
                  <option>Siponimod</option>
                </select>
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="extraanaliza" class="col-sm-2 col-form-label">Extra Analiza</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="extraanaliza" placeholder="Analiza" disabled>
              </div>
            </div>

            <div class="form-group row">
              <label for="timp" class="col-sm-2 col-form-label">Interval timp</label>
              <div class="form-group col-sm-10">
                <select id="extratimp" class="form-control" disabled>
                  <option selected>Choose...</option>
                  <option>3 luni</option>
                  <option>6 luni</option>
                  <option>1 an</option>

                </select>
              </div>
            </div>
            <div class="form-group row">
              <label for="exampleFormControlTextarea1">Extra notite</label>
              <textarea class="form-control" id="extra_notes" rows="3"></textarea>
            </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" id="submit_data">Save changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>



  <div class="modal fade" id="exampleModalCenter2" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Adaugare date pacient existent</h5>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group row" style="margin-top:10px;">
              <label for="nume" class="col-sm-2 col-form-label">Nume</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="nume_existent" placeholder="Nume">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="prenume" class="col-sm-2 col-form-label">Prenume</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="prenume_existent" placeholder="Prenume">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="cnp" class="col-sm-2 col-form-label">CNP</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="CNP_existent" placeholder="CNP">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="cnp" class="col-sm-2 col-form-label">Tratament</label>
              <div class="form-group col-sm-10">
                <select id="tratament_existent" class="form-control">
                  <option selected>Choose...</option>
                  <option>Interferon beta (Avonex, Betaferon, Rebif) </option>
                  <option>Glatiramer acetat</option>
                  <option>Fingolimod</option>
                  <option>Terliflunomida</option>
                  <option>Dimetil fumarate</option>
                  <option>Ocrelizumab</option>
                  <option>Natalizumab</option>
                  <option>Alemtuzumab</option>
                  <option>Siponimod</option>
                </select>
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="extraanaliza" class="col-sm-2 col-form-label">Data incepere tratament</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="start_time" placeholder="12/2022">
              </div>
            </div>
            <div class="form-group row">
              <label for="exampleFormControlTextarea1">Extra notite</label>
              <textarea class="form-control" id="extra_notes" rows="3"></textarea>
            </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" id="submit_data_existent">Save changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>

  

  <div class="modal fade" id="changePatient" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Modifica date pacient</h5>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group row" style="margin-top:10px;">
              <label for="nume" class="col-sm-2 col-form-label">Nume</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="change_nume" placeholder="Nume">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="prenume" class="col-sm-2 col-form-label">Prenume</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="change_prenume" placeholder="Prenume">
              </div>
            </div>
            <div class="form-group row" style="margin-top:10px;">
              <label for="cnp" class="col-sm-2 col-form-label">CNP</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="change_CNP" placeholder="CNP">
              </div>
            </div>
            <!-- <div class="form-group row" style="margin-top:10px;">
              <label for="cnp" class="col-sm-2 col-form-label">Tratament</label>
              <div class="form-group col-sm-10">
                <select id="change_tratament" class="form-control">
                  <option selected>Choose...</option>
                  <option>Interferon beta (Avonex, Betaferon, Rebif) </option>
                  <option>Glatiramer acetat</option>
                  <option>Fingolimod</option>
                  <option>Terliflunomida</option>
                  <option>Dimetil fumarate</option>
                  <option>Ocrelizumab</option>
                  <option>Natalizumab</option>
                  <option>Alemtuzumab</option>
                  <option>Siponimod</option>
                </select>
              </div>
            </div> -->
            <div class="form-group row" style="margin-top:10px;">
              <label for="change_extraanaliza" class="col-sm-2 col-form-label">Extra Analiza</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="extraanaliza" placeholder="Analiza" disabled>
              </div>
            </div>

            <div class="form-group row">
              <label for="timp" class="col-sm-2 col-form-label">Interval timp</label>
              <div class="form-group col-sm-10">
                <select id="change_extratimp" class="form-control" disabled>
                  <option selected>Choose...</option>
                  <option>3 luni</option>
                  <option>6 luni</option>
                  <option>1 an</option>

                </select>
              </div>
            </div>
            <div class="form-group row">
              <label for="exampleFormControlTextarea1">Extra notite</label>
              <textarea class="form-control" id="change_extra_notes" rows="3"></textarea>
            </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" id="resubmit_data">Save changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="detailsPatient" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Detalii pacient</h5>
        </div>
        <div class="modal-body">
          <p id="detailsContent"></p>

        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <!-- <script src="../assets/dist/js/bootstrap.bundle.min.js"></script> -->
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
    integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
    integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js"
    integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
    crossorigin="anonymous"></script>
  
  <script src="dashboard.js"></script>
  <script>
      var patientData; 

    $(document).ready(function () {

     

      $("#submit_data").click(function (event) {
        event.preventDefault();
        var formData = {
          nume: $("#nume").val(),
          prenume: $("#prenume").val(),
          cnp: $("#CNP").val(),
          tratament: $('#tratament').find(":selected").text(),
          extraanaliza: $("#extraanaliza").val(),
          extratimp: $('#extratimp').find(":selected").text(),
          extranotite: $("#extra_notes").val(),
        };

        console.log(JSON.stringify(formData))

        $.ajax({
          type: "POST",
          url: "/add_patient",
          async:false,
          data: JSON.stringify(formData),
          contentType: false,
          processData: false,
          cache: false,

        }).done(function (data) {
          console.log(data);
          location.reload();
        });


      });

      $("#submit_data_existent").click(function (event) {
        event.preventDefault();
        var formData = {
          nume: $("#nume_existent").val(),
          prenume: $("#prenume_existent").val(),
          cnp: $("#CNP_existent").val(),
          start_time: $("#start_time").val(),
          tratament: $('#tratament_existent').find(":selected").text(),
          extraanaliza: $("#extraanaliza").val(),
          extratimp: $('#extratimp').find(":selected").text(),
          extranotite: $("#extra_notes").val(),
        };

        console.log(JSON.stringify(formData))

        $.ajax({
          type: "POST",
          url: "/add_patient_existent",
          async:false,
          data: JSON.stringify(formData),
          contentType: false,
          processData: false,
          cache: false,

        }).done(function (data) {
          console.log(data);
          location.reload();
        });


      });

      $("#resubmit_data").click(function (event) {
        event.preventDefault();
        var formData = {
          nume: $("#change_nume").val(),
          prenume: $("#change_prenume").val(),
          cnp: $("#change_CNP").val(),
          // tratament: $('#tratament').find(":selected").text(),
          extraanaliza: $("#extraanaliza").val(),
          extratimp: $('#extratimp').find(":selected").text(),
          extranotite: $("#change_extra_notes").val(),
        };

        console.log(JSON.stringify(formData))

        $.ajax({
          type: "POST",
          url: "/update_patient",
          data: JSON.stringify(formData),
          async:false,
          contentType: false,
          processData: false,
          cache: false,

        }).done(function (data) {
          console.log(data);
          location.reload();
        });


      });
   
    

    $.ajax({

      type: "GET",
      url: "/get_patient",
      contentType: false,
      processData: false,
      cache: false,
      async: false,

    }).done(function (data) {

      console.log(JSON.parse(data));
      parsed = JSON.parse(data)
      patientData = parsed;


      $.each(parsed, function (i, l) {
        $('#patients').append(`<tr>
                <td>`+ l["nume"] + ' ' + l["prenume"] + `</td>
                <td id="cnp_`+i+`">`+l["cnp"]+`</td>
                <td>`+l["tratament"]+`</td>
                <td><button type="button" id="patient_`+i+`" class=" details_patient btn btn-outline-success btn-sm" data-toggle="modal"
                data-target="#detailsPatient">Detalii</button></td>
                <td><button type="button" id="patient_`+i+`" class="change_patient btn btn-outline-warning btn-sm" data-toggle="modal"
                data-target="#changePatient">Modifica</button></td>
                <td><button type="button" id="patient_`+i+`" class="delete_patient btn btn-outline-danger btn-sm">Sterge</a></button> </td>
              </tr>`);
      });

      $('.generate_excel').click(function (event) {
        $.ajax({
          type: "GET",
          url: "/generate_xls",
        }).done(function (data) {
          
        });
      });

      $('.details_patient').click(function (event) {
        var id =$(this).attr('id')
        console.log(id)
        const i = parseInt(id.split("_")[1]);
        var sendData = {
          "cnp": patientData[i].cnp
        }
        
        $.ajax({
          type: "GET",
          url: "/details_patient?cnp="+patientData[i].cnp,
          
        }).done(function (data) {
          
          $("#detailsContent").text(data["notes"])

        });


      });

      $('.change_patient').click(function (event) {
        var id =$(this).attr('id')
        console.log(id)
        const i = parseInt(id.split("_")[1]);
        
        
        $.ajax({
          type: "GET",
          url: "/change_patient?cnp="+patientData[i].cnp,
          
        }).done(function (data) {
          
          info = JSON.parse(data)
          
          $("#change_nume").val(info["nume"])
          $("#change_prenume").val(info["prenume"])
          $("#change_CNP").val(info["cnp"])
          $("#change_extraanaliza").val(info["extraanaliza"])
          $('#change_extratimp').find(":selected").text()
          $("#change_extra_notes").val(info["extranotite"])


        });


      });

      
      $('.delete_patient').click(function (event) {
        var id =$(this).attr('id')
        const i = parseInt(id.split("_")[1]);
        var sendData = {
          "cnp": patientData[i].cnp
        }
        
        $.ajax({
          type: "POST",
          url: "/delete_patient",
          data: JSON.stringify(sendData),
          contentType: false,
          async:false,
          processData: false,
          cache: false,

        }).done(function (data) {
          console.log("Done");
          location.reload();
        });


      });
      
      
    });
  });

  </script>
</body>

</html>